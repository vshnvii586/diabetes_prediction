# -*- coding: utf-8 -*-
"""diabetes_model

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kFh9u4nLDE9p4iMfVNqSXrinXbvpvWje
"""

import pandas as pd

url = "https://raw.githubusercontent.com/plotly/datasets/master/diabetes.csv"
df = pd.read_csv(url)

df.head()

df.columns

from sklearn.model_selection import train_test_split
X = df.drop('Outcome', axis=1)
y = df['Outcome']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

from sklearn.ensemble import RandomForestClassifier
model = RandomForestClassifier()
model.fit(X_train, y_train)

from sklearn.metrics import accuracy_score
y_pred = model.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)
print("Model Accuracy:", accuracy)

def predict_diabetes(pregnancies, glucose, blood_pressure, skin_thickness, insulin, bmi, dpf, age):
  input_data = [[pregnancies, glucose, blood_pressure, skin_thickness, insulin, bmi, dpf, age]]
  prediction = model.predict(input_data)
  return prediction[0]

result = predict_diabetes(2, 120, 70, 20, 85, 28.0, 0.5, 25)
print("Prediction:", result)

print("Shape of dataset:", df.shape)
print("\nColumns:\n, df.columns")

print("n\nBasic statistics (describe):")
display(df.describe())

print("\n\nMissing values per column:")
print(df.isnull().sum())

print("\n\nOutcome value counts (0 = No, 1 = Yes):")
print(df['Outcome'].value_counts())

import matplotlib.pyplot as plt
import seaborn as sns

df.hist(figsize=(12, 10), bins=20)
plt.tight_layout()
plt.show()

import numpy as np

cols_to_fix = ['Glucose', "BloodPressure", "SkinThickness", "Insulin", "BMI"]
df_clean = df.copy()

for col in cols_to_fix:
  df_clean[col] = df_clean[col].replace(0, np.nan)

for col in cols_to_fix:
  df_clean[col] = df_clean[col].fillna(df_clean[col].median())
df_clean.isnull().sum()

from sklearn.preprocessing import StandardScaler

X = df_clean.drop("Outcome", axis = 1)
y = df_clean["Outcome"]

scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier

X_train, X_test, y_train, y_test = train_test_split(X_scaled, y, test_size=0.2, random_state=42)
rf_model = RandomForestClassifier(random_state=42)
rf_model.fit(X_train, y_train)

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred = rf_model.predict(X_test)

acc = accuracy_score(y_test, y_pred)
prec = precision_score(y_test, y_pred)
rec = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

acc, prec, rec, f1

from sklearn.metrics import confusion_matrix

cm = confusion_matrix(y_test, y_pred)
cm

from sklearn.linear_model import LogisticRegression

lr_model = LogisticRegression(max_iter=500)
lr_model.fit(X_train, y_train)

y_pred_lr = lr_model.predict(X_test)

acc_lr = accuracy_score(y_test, y_pred_lr)
prec_lr = precision_score(y_test, y_pred_lr)
rec_lr = recall_score(y_test, y_pred_lr)
f1_lr = f1_score(y_test, y_pred_lr)

acc_lr, prec_lr, rec_lr, f1_lr

rf_tuned = RandomForestClassifier(n_estimators=100, max_depth=8, random_state=42)

rf_tuned.fit(X_train, y_train)

y_pred_tuned = rf_tuned.predict(X_test)

acc_tuned = accuracy_score(y_test, y_pred_tuned)
prec_tuned = precision_score(y_test, y_pred_tuned)
rec_tuned = recall_score(y_test, y_pred_tuned)
f1_tuned = f1_score(y_test, y_pred_tuned)

acc_tuned, prec_tuned, rec_tuned, f1_tuned

import joblib

joblib.dump(rf_tuned, "diabetes_model.pkl")

joblib.dump(scaler, "scaler.pkl")

from google.colab import files

files.download("diabetes_model.pkl")
files.download("scaler.pkl")